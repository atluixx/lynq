datasource db {
  url      = env("DATABASE_URL")
  provider = "postgresql"
}

generator db {
  provider = "prisma-client-js"
}

model User {
  id String @id @default(cuid())

  username      String  @unique
  email         String  @unique
  password_hash String
  profile_image String?
  bio           String?
  background    String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  links Link[]
}

model Link {
  id String @id @default(cuid())

  title      String
  url        String
  order      Int
  expires_at DateTime?
  max_clicks DateTime?
  is_active  Boolean?  @default(true)

  user_id String
  user    User   @relation(fields: [user_id], references: [id])

  analytics Analytics[]
}

model Analytics {
  id           String   @id @default(cuid())
  clicked_at   DateTime @default(now())
  visitor_ip   String
  user_agent   String
  country      String
  total_clicks Int      @default(0)
  refferer     String?

  link_id String
  link    Link   @relation(fields: [link_id], references: [id])
}

model Api {
  id              String    @id @default(cuid())
  key_hash        String    @unique
  expiration_time DateTime?
  active          Boolean   @default(true)
  permissions     Json      @default("[\"users:create\"]")

  created_at DateTime @default(now())
}
